{% extends "base.html" %}

{% block content %}
<div class="profile-page">
    <div class="profile-container">
        <div class="profile-sidebar">
            <div class="profile-avatar">
                <img src="/static/images/avatar-placeholder.png" alt="User Avatar" class="avatar-image" id="user-avatar">
                <button class="btn btn-sm btn-secondary change-avatar">Change Photo</button>
            </div>
            
            <ul class="profile-nav">
                <li class="profile-nav-item active" data-target="account">
                    <i class="mdi mdi-account"></i> Account
                </li>
                <li class="profile-nav-item" data-target="security">
                    <i class="mdi mdi-shield-lock"></i> Security
                </li>
                <li class="profile-nav-item" data-target="preferences">
                    <i class="mdi mdi-tune"></i> Preferences
                </li>
                <li class="profile-nav-item" data-target="notifications">
                    <i class="mdi mdi-bell"></i> Notifications
                </li>
                <li class="profile-nav-item" data-target="activity">
                    <i class="mdi mdi-history"></i> Activity Log
                </li>
            </ul>
        </div>
        
        <div class="profile-content">
            <!-- Account Settings -->
            <div class="profile-section active" id="account">
                <h2>Account Information</h2>
                
                <form class="profile-form" id="account-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="first-name">First Name</label>
                            <input type="text" id="first-name" name="first_name" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label for="last-name">Last Name</label>
                            <input type="text" id="last-name" name="last_name" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" class="form-control" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" name="phone" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="job-title">Job Title</label>
                        <input type="text" id="job-title" name="job_title" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="bio">Bio</label>
                        <textarea id="bio" name="bio" class="form-control" rows="4"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                        <button type="reset" class="btn btn-secondary">Reset</button>
                    </div>
                </form>
            </div>
            
            <!-- Security Settings -->
            <div class="profile-section" id="security">
                <h2>Security Settings</h2>
                
                <form class="profile-form" id="security-form">
                    <div class="form-group">
                        <label for="current-password">Current Password</label>
                        <input type="password" id="current-password" name="current_password" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="new-password">New Password</label>
                        <input type="password" id="new-password" name="new_password" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm-password">Confirm New Password</label>
                        <input type="password" id="confirm-password" name="confirm_password" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>Two-Factor Authentication</label>
                        <div class="toggle-switch">
                            <input type="checkbox" id="two-factor" name="two_factor" class="toggle-input">
                            <label for="two-factor" class="toggle-label"></label>
                            <span class="toggle-text">Enable two-factor authentication</span>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Update Password</button>
                    </div>
                </form>
            </div>
            
            <!-- Preferences -->
            <div class="profile-section" id="preferences">
                <h2>User Preferences</h2>
                
                <form class="profile-form" id="preferences-form">
                    <div class="form-group">
                        <label for="language">Language</label>
                        <select id="language" name="language" class="form-control">
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="timezone">Timezone</label>
                        <select id="timezone" name="timezone" class="form-control">
                            <option value="UTC">UTC</option>
                            <option value="EST">Eastern Standard Time (EST)</option>
                            <option value="CST">Central Standard Time (CST)</option>
                            <option value="MST">Mountain Standard Time (MST)</option>
                            <option value="PST">Pacific Standard Time (PST)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="date-format">Date Format</label>
                        <select id="date-format" name="date_format" class="form-control">
                            <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                            <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Theme</label>
                        <div class="theme-options">
                            <div class="theme-option" data-theme="light">
                                <div class="theme-preview light-theme"></div>
                                <span>Light</span>
                            </div>
                            <div class="theme-option" data-theme="dark">
                                <div class="theme-preview dark-theme"></div>
                                <span>Dark</span>
                            </div>
                            <div class="theme-option" data-theme="system">
                                <div class="theme-preview system-theme"></div>
                                <span>System</span>
                            </div>
                        </div>
                        <input type="hidden" id="theme" name="theme" value="light">
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Preferences</button>
                    </div>
                </form>
            </div>
            
            <!-- Notifications -->
            <div class="profile-section" id="notifications">
                <h2>Notification Settings</h2>
                
                <form class="profile-form" id="notifications-form">
                    <div class="form-group">
                        <label>Email Notifications</label>
                        <div class="notification-option">
                            <div class="toggle-switch">
                                <input type="checkbox" id="email-orders" name="email_orders" class="toggle-input" checked>
                                <label for="email-orders" class="toggle-label"></label>
                            </div>
                            <div class="notification-text">
                                <span>Order Updates</span>
                                <p>Receive emails about new orders and status changes</p>
                            </div>
                        </div>
                        
                        <div class="notification-option">
                            <div class="toggle-switch">
                                <input type="checkbox" id="email-inventory" name="email_inventory" class="toggle-input" checked>
                                <label for="email-inventory" class="toggle-label"></label>
                            </div>
                            <div class="notification-text">
                                <span>Inventory Alerts</span>
                                <p>Receive emails when products are low in stock</p>
                            </div>
                        </div>
                        
                        <div class="notification-option">
                            <div class="toggle-switch">
                                <input type="checkbox" id="email-marketing" name="email_marketing" class="toggle-input">
                                <label for="email-marketing" class="toggle-label"></label>
                            </div>
                            <div class="notification-text">
                                <span>Marketing Updates</span>
                                <p>Receive emails about new features and promotions</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>In-App Notifications</label>
                        <div class="notification-option">
                            <div class="toggle-switch">
                                <input type="checkbox" id="app-orders" name="app_orders" class="toggle-input" checked>
                                <label for="app-orders" class="toggle-label"></label>
                            </div>
                            <div class="notification-text">
                                <span>Order Updates</span>
                                <p>Receive notifications about new orders and status changes</p>
                            </div>
                        </div>
                        
                        <div class="notification-option">
                            <div class="toggle-switch">
                                <input type="checkbox" id="app-inventory" name="app_inventory" class="toggle-input" checked>
                                <label for="app-inventory" class="toggle-label"></label>
                            </div>
                            <div class="notification-text">
                                <span>Inventory Alerts</span>
                                <p>Receive notifications when products are low in stock</p>
                            </div>
                        </div>
                        
                        <div class="notification-option">
                            <div class="toggle-switch">
                                <input type="checkbox" id="app-system" name="app_system" class="toggle-input" checked>
                                <label for="app-system" class="toggle-label"></label>
                            </div>
                            <div class="notification-text">
                                <span>System Notifications</span>
                                <p>Receive notifications about system updates and maintenance</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Notification Settings</button>
                    </div>
                </form>
            </div>
            
            <!-- Activity Log -->
            <div class="profile-section" id="activity">
                <h2>Activity Log</h2>
                
                <div class="activity-filters">
                    <div class="form-group">
                        <label for="activity-type">Filter by Type</label>
                        <select id="activity-type" class="form-control">
                            <option value="all">All Activities</option>
                            <option value="login">Login</option>
                            <option value="order">Orders</option>
                            <option value="inventory">Inventory</option>
                            <option value="settings">Settings</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="activity-date">Filter by Date</label>
                        <select id="activity-date" class="form-control">
                            <option value="all">All Time</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                        </select>
                    </div>
                </div>
                
                <div class="activity-list" id="activity-list">
                    <!-- Activity items will be loaded dynamically -->
                    <div class="activity-item">
                        <div class="activity-icon login">
                            <i class="mdi mdi-login"></i>
                        </div>
                        <div class="activity-details">
                            <div class="activity-title">Login</div>
                            <div class="activity-description">Logged in from 192.168.1.1</div>
                            <div class="activity-time">Today, 10:30 AM</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon order">
                            <i class="mdi mdi-cart"></i>
                        </div>
                        <div class="activity-details">
                            <div class="activity-title">New Order</div>
                            <div class="activity-description">Created order #12345</div>
                            <div class="activity-time">Yesterday, 3:45 PM</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon inventory">
                            <i class="mdi mdi-package-variant"></i>
                        </div>
                        <div class="activity-details">
                            <div class="activity-title">Inventory Update</div>
                            <div class="activity-description">Added 10 units of Product A</div>
                            <div class="activity-time">Mar 8, 2025, 11:20 AM</div>
                        </div>
                    </div>
                </div>
                
                <div class="activity-pagination">
                    <button class="btn btn-sm btn-secondary" disabled>Previous</button>
                    <span>Page 1 of 1</span>
                    <button class="btn btn-sm btn-secondary" disabled>Next</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Load user data
        loadUserData();
        
        // Form submission handlers
        setupFormHandlers();
        
        // Theme selection
        setupThemeSelection();
        
        // Tab navigation
        setupTabNavigation();
    });
    
    function loadUserData() {
        // Get user data from localStorage
        const userData = JSON.parse(localStorage.getItem('user_data') || '{}');
        
        // Populate account form
        document.getElementById('first-name').value = userData.first_name || '';
        document.getElementById('last-name').value = userData.last_name || '';
        document.getElementById('email').value = userData.email || '';
        document.getElementById('phone').value = userData.phone || '';
        document.getElementById('job-title').value = userData.job_title || '';
        document.getElementById('bio').value = userData.bio || '';
        
        // Set user avatar if available
        if (userData.avatar) {
            document.getElementById('user-avatar').src = userData.avatar;
        }
        
        // Set preferences
        document.getElementById('language').value = userData.language || 'en';
        document.getElementById('timezone').value = userData.timezone || 'UTC';
        document.getElementById('date-format').value = userData.date_format || 'MM/DD/YYYY';
        
        // Set theme
        const theme = userData.theme || 'light';
        document.getElementById('theme').value = theme;
        document.querySelectorAll('.theme-option').forEach(option => {
            if (option.dataset.theme === theme) {
                option.classList.add('active');
            } else {
                option.classList.remove('active');
            }
        });
        
        // Set notification preferences
        if (userData.notifications) {
            document.getElementById('email-orders').checked = userData.notifications.email_orders !== false;
            document.getElementById('email-inventory').checked = userData.notifications.email_inventory !== false;
            document.getElementById('email-marketing').checked = userData.notifications.email_marketing === true;
            document.getElementById('app-orders').checked = userData.notifications.app_orders !== false;
            document.getElementById('app-inventory').checked = userData.notifications.app_inventory !== false;
            document.getElementById('app-system').checked = userData.notifications.app_system !== false;
        }
        
        // Set security preferences
        if (userData.security) {
            document.getElementById('two-factor').checked = userData.security.two_factor === true;
        }
    }
    
    function setupFormHandlers() {
        // Account form
        const accountForm = document.getElementById('account-form');
        if (accountForm) {
            accountForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form data
                const formData = new FormData(accountForm);
                const accountData = Object.fromEntries(formData.entries());
                
                // Get existing user data
                const userData = JSON.parse(localStorage.getItem('user_data') || '{}');
                
                // Update user data
                const updatedUserData = { ...userData, ...accountData };
                
                // Save to localStorage
                localStorage.setItem('user_data', JSON.stringify(updatedUserData));
                
                // Show success notification
                if (window.Notifications) {
                    window.Notifications.show('Account information updated successfully', 'success');
                }
            });
        }
        
        // Security form
        const securityForm = document.getElementById('security-form');
        if (securityForm) {
            securityForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form data
                const formData = new FormData(securityForm);
                const securityData = Object.fromEntries(formData.entries());
                
                // Validate passwords
                if (securityData.new_password) {
                    if (securityData.new_password !== securityData.confirm_password) {
                        if (window.Notifications) {
                            window.Notifications.show('Passwords do not match', 'error');
                        }
                        return;
                    }
                    
                    if (securityData.new_password.length < 8) {
                        if (window.Notifications) {
                            window.Notifications.show('Password must be at least 8 characters long', 'error');
                        }
                        return;
                    }
                }
                
                // Get existing user data
                const userData = JSON.parse(localStorage.getItem('user_data') || '{}');
                
                // Update security data
                userData.security = userData.security || {};
                userData.security.two_factor = securityData.two_factor === 'on';
                
                // Save to localStorage
                localStorage.setItem('user_data', JSON.stringify(userData));
                
                // Show success notification
                if (window.Notifications) {
                    window.Notifications.show('Security settings updated successfully', 'success');
                }
                
                // Clear password fields
                document.getElementById('current-password').value = '';
                document.getElementById('new-password').value = '';
                document.getElementById('confirm-password').value = '';
            });
        }
        
        // Preferences form
        const preferencesForm = document.getElementById('preferences-form');
        if (preferencesForm) {
            preferencesForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form data
                const formData = new FormData(preferencesForm);
                const preferencesData = Object.fromEntries(formData.entries());
                
                // Get existing user data
                const userData = JSON.parse(localStorage.getItem('user_data') || '{}');
                
                // Update preferences
                const updatedUserData = { ...userData, ...preferencesData };
                
                // Save to localStorage
                localStorage.setItem('user_data', JSON.stringify(updatedUserData));
                
                // Show success notification
                if (window.Notifications) {
                    window.Notifications.show('Preferences updated successfully', 'success');
                }
            });
        }
        
        // Notifications form
        const notificationsForm = document.getElementById('notifications-form');
        if (notificationsForm) {
            notificationsForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form data
                const formData = new FormData(notificationsForm);
                const notificationsData = {
                    email_orders: formData.get('email_orders') === 'on',
                    email_inventory: formData.get('email_inventory') === 'on',
                    email_marketing: formData.get('email_marketing') === 'on',
                    app_orders: formData.get('app_orders') === 'on',
                    app_inventory: formData.get('app_inventory') === 'on',
                    app_system: formData.get('app_system') === 'on'
                };
                
                // Get existing user data
                const userData = JSON.parse(localStorage.getItem('user_data') || '{}');
                
                // Update notifications
                userData.notifications = notificationsData;
                
                // Save to localStorage
                localStorage.setItem('user_data', JSON.stringify(userData));
                
                // Show success notification
                if (window.Notifications) {
                    window.Notifications.show('Notification settings updated successfully', 'success');
                }
            });
        }
    }
    
    function setupThemeSelection() {
        const themeOptions = document.querySelectorAll('.theme-option');
        const themeInput = document.getElementById('theme');
        
        themeOptions.forEach(option => {
            option.addEventListener('click', function() {
                // Remove active class from all options
                themeOptions.forEach(opt => opt.classList.remove('active'));
                
                // Add active class to clicked option
                this.classList.add('active');
                
                // Update hidden input
                themeInput.value = this.dataset.theme;
            });
        });
    }
    
    function setupTabNavigation() {
        // Get all nav items
        const navItems = document.querySelectorAll('.profile-nav-item');
        
        // Add click event to each nav item
        navItems.forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all nav items
                navItems.forEach(navItem => navItem.classList.remove('active'));
                
                // Add active class to clicked nav item
                this.classList.add('active');
                
                // Get target section id
                const targetId = this.getAttribute('data-target');
                
                // Hide all sections
                document.querySelectorAll('.profile-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show target section
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
            });
        });
    }
</script>
{% endblock %} 